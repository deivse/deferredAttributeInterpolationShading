/*
 * Cornell Box scene.
 */
#pragma once
#include <glbinding/gl/gl.h>
#include <glbinding/glbinding.h>

using namespace gl;

namespace Tools {
    namespace Mesh {
        static const GLfloat CORNELL_BOX[] = {
            //     x      y      z      w         nx       ny       nz       0.0f       r     g     b     a
            // RIGHT ------------------------------------------------------------------------------------------------->
                 1.00f,-1.00f,-1.00f, 1.00f,   -1.0000f, 0.0000f, 0.0000f, 0.0000f,    0.0f, 1.0f, 0.0f, 1.0f,
                 1.00f,-1.00f, 1.00f, 1.00f,   -1.0000f, 0.0000f, 0.0000f, 0.0000f,    0.0f, 1.0f, 0.0f, 1.0f,
                 1.00f, 1.00f, 1.00f, 1.00f,   -1.0000f, 0.0000f, 0.0000f, 0.0000f,    0.0f, 1.0f, 0.0f, 1.0f,
                 1.00f,-1.00f,-1.00f, 1.00f,   -1.0000f, 0.0000f, 0.0000f, 0.0000f,    0.0f, 1.0f, 0.0f, 1.0f,
                 1.00f, 1.00f, 1.00f, 1.00f,   -1.0000f, 0.0000f, 0.0000f, 0.0000f,    0.0f, 1.0f, 0.0f, 1.0f,
                 1.00f, 1.00f,-1.00f, 1.00f,   -1.0000f, 0.0000f, 0.0000f, 0.0000f,    0.0f, 1.0f, 0.0f, 1.0f,
            // LEFT -------------------------------------------------------------------------------------------------->
                -1.00f,-1.00f,-1.00f, 1.00f,    1.0000f, 0.0000f, 0.0000f, 0.0000f,    1.0f, 0.0f, 0.0f, 1.0f,
                -1.00f, 1.00f, 1.00f, 1.00f,    1.0000f, 0.0000f, 0.0000f, 0.0000f,    1.0f, 0.0f, 0.0f, 1.0f,
                -1.00f,-1.00f, 1.00f, 1.00f,    1.0000f, 0.0000f, 0.0000f, 0.0000f,    1.0f, 0.0f, 0.0f, 1.0f,
                -1.00f,-1.00f,-1.00f, 1.00f,    1.0000f, 0.0000f, 0.0000f, 0.0000f,    1.0f, 0.0f, 0.0f, 1.0f,
                -1.00f, 1.00f,-1.00f, 1.00f,    1.0000f, 0.0000f, 0.0000f, 0.0000f,    1.0f, 0.0f, 0.0f, 1.0f,
                -1.00f, 1.00f, 1.00f, 1.00f,    1.0000f, 0.0000f, 0.0000f, 0.0000f,    1.0f, 0.0f, 0.0f, 1.0f,
            // BOTTOM ------------------------------------------------------------------------------------------------>
                 1.00f,-1.00f,-1.00f, 1.00f,    0.0000f, 1.0000f, 0.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                -1.00f,-1.00f,-1.00f, 1.00f,    0.0000f, 1.0000f, 0.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 1.00f,-1.00f, 1.00f, 1.00f,    0.0000f, 1.0000f, 0.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                -1.00f,-1.00f,-1.00f, 1.00f,    0.0000f, 1.0000f, 0.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                -1.00f,-1.00f, 1.00f, 1.00f,    0.0000f, 1.0000f, 0.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 1.00f,-1.00f, 1.00f, 1.00f,    0.0000f, 1.0000f, 0.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
            // TOP --------------------------------------------------------------------------------------------------->
                 1.00f, 1.00f,-1.00f, 1.00f,    0.0000f,-1.0000f, 0.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 1.00f, 1.00f, 1.00f, 1.00f,    0.0000f,-1.0000f, 0.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                -1.00f, 1.00f,-1.00f, 1.00f,    0.0000f,-1.0000f, 0.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                -1.00f, 1.00f,-1.00f, 1.00f,    0.0000f,-1.0000f, 0.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 1.00f, 1.00f, 1.00f, 1.00f,    0.0000f,-1.0000f, 0.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                -1.00f, 1.00f, 1.00f, 1.00f,    0.0000f,-1.0000f, 0.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
             // BACK -------------------------------------------------------------------------------------------------->
                -1.00f,-1.00f,-1.00f, 1.00f,    0.0000f, 0.0000f, 1.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 1.00f,-1.00f,-1.00f, 1.00f,    0.0000f, 0.0000f, 1.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 1.00f, 1.00f,-1.00f, 1.00f,    0.0000f, 0.0000f, 1.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                -1.00f,-1.00f,-1.00f, 1.00f,    0.0000f, 0.0000f, 1.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 1.00f, 1.00f,-1.00f, 1.00f,    0.0000f, 0.0000f, 1.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                -1.00f, 1.00f,-1.00f, 1.00f,    0.0000f, 0.0000f, 1.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,

            // BOX 1 ------------------------------------------------------------------------------------------------->
                 0.49f,-0.36f, 0.75f, 1.00f,    0.0000f, 1.0000f, 0.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 0.68f,-0.36f, 0.12f, 1.00f,    0.0000f, 1.0000f, 0.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 0.06f,-0.36f,-0.06f, 1.00f,    0.0000f, 1.0000f, 0.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 0.49f,-0.36f, 0.75f, 1.00f,    0.0000f, 1.0000f, 0.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 0.06f,-0.36f,-0.06f, 1.00f,    0.0000f, 1.0000f, 0.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                -0.13f,-0.36f, 0.55f, 1.00f,    0.0000f, 1.0000f, 0.0000f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,

                -0.13f,-1.00f, 0.55f, 1.00f,   -0.9534f, 0.0000f,-0.3017f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                -0.13f,-0.36f, 0.55f, 1.00f,   -0.9534f, 0.0000f,-0.3017f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 0.06f,-1.00f,-0.06f, 1.00f,   -0.9534f, 0.0000f,-0.3017f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                -0.13f,-0.36f, 0.55f, 1.00f,   -0.9534f, 0.0000f,-0.3017f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 0.06f,-0.36f,-0.06f, 1.00f,   -0.9534f, 0.0000f,-0.3017f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 0.06f,-1.00f,-0.06f, 1.00f,   -0.9534f, 0.0000f,-0.3017f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,

                 0.49f,-1.00f, 0.75f, 1.00f,   -0.2928f, 0.0000f, 0.9562f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 0.49f,-0.36f, 0.75f, 1.00f,   -0.2928f, 0.0000f, 0.9562f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                -0.13f,-1.00f, 0.55f, 1.00f,   -0.2928f, 0.0000f, 0.9562f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 0.49f,-0.36f, 0.75f, 1.00f,   -0.2928f, 0.0000f, 0.9562f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                -0.13f,-0.36f, 0.55f, 1.00f,   -0.2928f, 0.0000f, 0.9562f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                -0.13f,-1.00f, 0.55f, 1.00f,   -0.2928f, 0.0000f, 0.9562f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,

                 0.68f,-1.00f, 0.12f, 1.00f,    0.9578f, 0.0000f, 0.2873f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 0.68f,-0.36f, 0.12f, 1.00f,    0.9578f, 0.0000f, 0.2873f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 0.49f,-1.00f, 0.75f, 1.00f,    0.9578f, 0.0000f, 0.2873f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 0.68f,-0.36f, 0.12f, 1.00f,    0.9578f, 0.0000f, 0.2873f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 0.49f,-0.36f, 0.75f, 1.00f,    0.9578f, 0.0000f, 0.2873f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 0.49f,-1.00f, 0.75f, 1.00f,    0.9578f, 0.0000f, 0.2873f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
              
                 0.06f,-1.00f,-0.06f, 1.00f,    0.2851f, 0.0000f,-0.9585f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 0.06f,-0.36f,-0.06f, 1.00f,    0.2851f, 0.0000f,-0.9585f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 0.68f,-1.00f, 0.12f, 1.00f,    0.2851f, 0.0000f,-0.9585f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 0.06f,-0.36f,-0.06f, 1.00f,    0.2851f, 0.0000f,-0.9585f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 0.68f,-0.36f, 0.12f, 1.00f,    0.2851f, 0.0000f,-0.9585f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,
                 0.68f,-1.00f, 0.12f, 1.00f,    0.2851f, 0.0000f,-0.9585f, 0.0000f,    1.0f, 1.0f, 1.0f, 1.0f,

            // BOX 2 ------------------------------------------------------------------------------------------------->
                -0.65f, 0.29f, 0.04f, 1.00f,    0.0000f, 1.0000f, 0.0000f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.04f, 0.29f,-0.16f, 1.00f,    0.0000f, 1.0000f, 0.0000f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.84f, 0.29f,-0.56f, 1.00f,    0.0000f, 1.0000f, 0.0000f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.04f, 0.29f,-0.16f, 1.00f,    0.0000f, 1.0000f, 0.0000f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.23f, 0.29f,-0.78f, 1.00f,    0.0000f, 1.0000f, 0.0000f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.84f, 0.29f,-0.56f, 1.00f,    0.0000f, 1.0000f, 0.0000f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,

                -0.65f,-1.00f, 0.04f, 1.00f,   -0.9556f, 0.0000f, 0.2945f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.65f, 0.29f, 0.04f, 1.00f,   -0.9556f, 0.0000f, 0.2945f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.84f,-1.00f,-0.56f, 1.00f,   -0.9556f, 0.0000f, 0.2945f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.65f, 0.29f, 0.04f, 1.00f,   -0.9556f, 0.0000f, 0.2945f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.84f, 0.29f,-0.56f, 1.00f,   -0.9556f, 0.0000f, 0.2945f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.84f,-1.00f,-0.56f, 1.00f,   -0.9556f, 0.0000f, 0.2945f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,

                -0.84f,-1.00f,-0.56f, 1.00f,   -0.3017f, 0.0000f,-0.9534f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.84f, 0.29f,-0.56f, 1.00f,   -0.3017f, 0.0000f,-0.9534f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.23f,-1.00f,-0.78f, 1.00f,   -0.3017f, 0.0000f,-0.9534f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.84f, 0.29f,-0.56f, 1.00f,   -0.3017f, 0.0000f,-0.9534f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.23f, 0.29f,-0.78f, 1.00f,   -0.3017f, 0.0000f,-0.9534f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.23f,-1.00f,-0.78f, 1.00f,   -0.3017f, 0.0000f,-0.9534f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
              
                -0.23f,-1.00f,-0.78f, 1.00f,    0.9562f, 0.0000f,-0.2928f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.23f, 0.29f,-0.78f, 1.00f,    0.9562f, 0.0000f,-0.2928f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.04f,-1.00f,-0.16f, 1.00f,    0.9562f, 0.0000f,-0.2928f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.23f, 0.29f,-0.78f, 1.00f,    0.9562f, 0.0000f,-0.2928f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.04f, 0.29f,-0.16f, 1.00f,    0.9562f, 0.0000f,-0.2928f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.04f,-1.00f,-0.16f, 1.00f,    0.9562f, 0.0000f,-0.2928f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,

                -0.04f,-1.00f,-0.16f, 1.00f,    0.2962f, 0.0000f, 0.9551f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.04f, 0.29f,-0.16f, 1.00f,    0.2962f, 0.0000f, 0.9551f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.65f,-1.00f, 0.04f, 1.00f,    0.2962f, 0.0000f, 0.9551f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.04f, 0.29f,-0.16f, 1.00f,    0.2962f, 0.0000f, 0.9551f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.65f, 0.29f, 0.04f, 1.00f,    0.2962f, 0.0000f, 0.9551f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
                -0.65f,-1.00f, 0.04f, 1.00f,    0.2962f, 0.0000f, 0.9551f, 0.0000f,     1.0f, 1.0f, 1.0f, 1.0f,
        };
    } // end of namespace Mesh

    //-----------------------------------------------------------------------------
    // Name: DrawCornelBox()
    // Desc:
    //-----------------------------------------------------------------------------
    void DrawCornellBox(bool withBoxes = true) {
        static GLuint s_vao = 0;
        if (s_vao == 0) {
            // Lazy initialization of VBO with cornel box mesh
            GLuint vbo = 0;
            glCreateBuffers(1, &vbo);
            glNamedBufferStorage(vbo, sizeof(Mesh::CORNELL_BOX), Mesh::CORNELL_BOX, BufferStorageMask::GL_NONE_BIT);
            glCreateVertexArrays(1, &s_vao);

            glVertexArrayVertexBuffer(s_vao, 0, vbo, 0, 12 * sizeof(float));

            glVertexArrayAttribFormat(s_vao, 0, 4, GL_FLOAT, GL_FALSE, 0);
            glVertexArrayAttribBinding(s_vao, 0, 0);
            glEnableVertexArrayAttrib(s_vao, 0);

            glVertexArrayAttribFormat(s_vao, 1, 3, GL_FLOAT, GL_FALSE, 4 * sizeof(float));
            glVertexArrayAttribBinding(s_vao, 1, 0);
            glEnableVertexArrayAttrib(s_vao, 1);

            glVertexArrayAttribFormat(s_vao, 2, 4, GL_FLOAT, GL_FALSE, 8 * sizeof(float));
            glVertexArrayAttribBinding(s_vao, 2, 0);
            glEnableVertexArrayAttrib(s_vao, 2);
            // glDeleteBuffers(1, &vbo); // Temporary disabled because of ATI driver bug
        }
    
        glBindVertexArray(s_vao);
        const int NUM_VERTICES = sizeof(Mesh::CORNELL_BOX) / (12*sizeof(GLfloat));
        glDrawArrays(GL_TRIANGLES, 0, withBoxes ? NUM_VERTICES : 30);
        glBindVertexArray(0);
    }
} // end of namespace Tools
